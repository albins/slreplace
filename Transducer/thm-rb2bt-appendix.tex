%!TEX root = main.tex

\section{Proof of Theorem~\ref{thm-rb-2pt}}\label{app-rb-2pt}

We first show that the $\expspace$ upper bound holds for the extension of \PT{}s with the reverse function. 

We then reduce in polynomial time the satisfiability problem for $k$-\RBPPT{}s to that for \PT{}s plus reverse function.

Let $y := \Transducer(x)$ be an assignment statement in $S$ such that $\Transducer = (\controls, q_0, \finals, \transrel)$ is $(2k)$-reversal bounded for some $k > 0$. We replace $y := \Transducer(x)$ by a program $S'$ as follows.

Each accepting run of $\Transducer$ on an input string can be split into $2k+1$ maximal subruns without reversals.
Intuitively, we shall split $y$ into $2k+1$ substrings, corresponding to the $2k+1$ maximal subruns, and for each substring of $y$, use one \PT{} and the reverse function to produce it.

\newcommand\prefix{\mathsf{prefix}}
\newcommand\suffix{\mathsf{suffix}}
\newcommand\finalpass{\mathsf{finalpass}}
\newcommand\reverse{\mathsf{reverse}}
\newcommand\concatpt{\mathsf{concat}}

For preparation, we introduce the following \FT{}s $\prefix_1, \prefix_3, \ldots, \prefix_{2k-1}$, and $\suffix_2, \ldots, \suffix_{2k}$, $\finalpass_{2k+1}$, as well as a \PT{}  $\concatpt$ that concatenates $2k+1$ strings, where there are one input string and $2k$ parameters. Let $w = a_1 \ldots a_n$ denote the input string.
\begin{itemize}
\item for $j \in [k]$, $\prefix_{2j-1}$  has the input alphabet $\ialphabet \cup \ialphabet \times [2j-2]$ and the output alphabet $\ialphabet \cup \ialphabet \times [2j-1]$, $\prefix_{2j-1}$ moves to the first occurrence of the letters from $\ialphabet \times \{2j-2\}$, say position $i$, and nondeterministically chooses a prefix of $w[i, n]$, and outputs $(b, 2j-1)$ for each letter $b \in \ialphabet$ or $(b, j')$ with $j' < 2j-1$ in the prefix,
%
\item for $j \in [k]$, $\suffix_{2j}$ has the input alphabet $\ialphabet \cup \ialphabet \times [2j-1]$ and the output alphabet $\ialphabet \cup \ialphabet \times [2j]$, $\suffix_{2j}$ nondeterministically chooses  a suffix of $w[1, i]$, where $i$ is the position corresponding to the last occurrence of the letters from $\ialphabet \times \{2j-1\}$, and outputs $(b, 2j)$ for each letter $b \in \ialphabet$ or $(b, j')$ with $j' < 2j$ in the suffix,
%
\item $\finalpass_{2k+1}$ has the input alphabet $\ialphabet \cup \ialphabet \times [2k]$ and the output alphabet $\ialphabet \cup \ialphabet \times [2k+1]$, it outputs $(b, 2k+1)$ for each letter $b$ or $(b, j')$ with $j' \le 2k$ in the suffix of $w$ starting from the first occurrence of the letters from $\ialphabet \cup \ialphabet \times \{2k\}$,
%
\item $\Transducer_{f, 2j-1}$ and $\Transducer_{b, 2j}$.
\end{itemize}

%
The program $S'$ is constructed as follows: 
\[
\begin{array}{l}
x_1 := \prefix_1(x), \\
%
x_2 := \suffix_{2} (x_1), \\
%
\ldots \\
%
x_{2k-1} := \prefix_{2k-1}(x_{2k-2}), \\
%
x_{2k} := \suffix_{2k} (x_{2k-1}), \\
% 
x_{2k+1} := \finalpass_{2k+1}(x_{2k}),\\
%
y_1 := \Transducer_{f,1}(x_1),\\
%
y'_2 := \Transducer_{b,2}(x_2),\\
%
y_2 := \reverse(y'_2),\\
%
\ldots\\
%
y_{2k-1} := \Transducer_{f, 2k-1}(x_{2k-1}),\\
%
y'_{2k} := \Transducer_{b, 2k}(x_{2k}),\\
%
y_{2k} := \reverse(y'_{2k}),\\
%
y_{2k+1} :=\Transducer_{f, 2k+1}(x_{2k+1}),\\
%
y := \concatpt(y_1, \ldots, y_{2k+1}).
\end{array}
\]