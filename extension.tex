%!TEX root = popl2018.tex

\section{Undecidable extensions}

In this section, we extend the language $\strline[\concat,\replaceall]$ with integer and character constraints. The language will use variables of, in additional to the type $\str$, the Integer data type $\intnum$. The type $\str$ consists of the string variables as in the previous sections. A variable of type $\intnum$, usually referred to as \emph{integer variables}, ranges over the set $\mathbb{N}$ of all natural numbers. Recall that, in previous sections, we have used $x, y, z, \cdots$ to denote the variables of $\str$ type.  Hereafter we typically use $\mathfrak{l}, \mathfrak{m}, \mathfrak{n}, \cdots$ to denote the variables of $\intnum$. s. The
choice of omitting negative integers is only for simplicity, but our
results easily extend to the case when $\intnum$ includes negative integers.

We start by defining integer constraints, which expresses length or number of occurrences of symbols in words. 


\begin{definition}[Integer constraints] An atomic integer constraints over $\Sigma$ is an expression of the form
	\[a_1t_1+\cdots+a_nt_n\leq d\]
where $a_1, \cdots, a_n,d\in \mathbb{Z}$ are constant integers (represented in binary), and each \emph{term} $t_i$ is either 
	\begin{enumerate}
		\item an integer variable $\mathfrak{n}$;
		\item $|x|$ where $x$ is a  string variable; or 
		\item $|x|_a$ where $x$ is string variable and $a\in \Sigma$ is a constant letter.
	\end{enumerate}
Here, $|x|$ and $|x|_a$ denotes the length of $x$ and the number of occurrences of $a$ in $x$, respectively. 

An \emph{integer constraint} over $\Sigma$ is a Boolean combination of atomic integer constraints over $\Sigma$
\end{definition}

Character constraints, on the other hand, allow to compare symbols from different strings. The formal definitions are given as follows. 

\begin{definition}[Character constraints]
	An \emph{atomic character constraint} over $\Sigma$ is an expression of the form $x[u]=y[v]$ where 
	\begin{itemize}
		\item $x$ and $y$ are either a string variable or a word in $\Sigma^*$, and 
		\item $u$ and $v$ are either integer variables or constants positive integers.
	\end{itemize} 
Here, the interpretation of $x[u]$ is $u$-th letter of $x$.	
	
A \emph{character constraint} over $\Sigma$ is a Boolean combination of atomic character constraints over $\Sigma$. 
\end{definition}


Recall the Hilbert 10th problem, which is, for any given Diophantine equation (a polynomial equation with integer coefficients and a finite number of unknowns), to decide whether the equation has a solution with all unknowns taking integer values. It is easy to observe that given two polynomials with positive integral coefficients over the same set of variables $x_1, \cdots, x_n$, it is \emph{undecidable} to check whether $f(x_1, \cdots, x_n)=g(x_1, \cdots, x_n)$ has a solution in natural numbers. 

\subsection{Undecidability of length constraints}

\begin{theorem}
	The satisfiability problem for SL[$\replaceall$] with \emph{length constraints} is undecidable. 
\end{theorem}

\begin{proof}
	We shall reduce from the aforementioned version of the Hilbert tenth problem. For any polynomial with positive integral  $f(x_1, \cdots, x_n)$ where each coefficient is a positive, we can construct a (division-free) arithmetic circuit (AC) is a directed  acyclic graph with nodes labelled with constants from $\mathbb{Z}$, or with some indeterminates $X_1, \cdots, X_m$, or with the operators $+, -, *$. The nodes labelled with constants are called constant nodes, while those labelled with indeterminates are called input nodes. Both constant and input nodes do not have incoming edges. Internal nodes are those labelled with $+,-,*$. Output node is the one which does not have out-going edges. Without loss of generality we assume that each internal node has in-degree 2, and there is only one output node. Each node in the circuit represents a multivariate polynomial $\mathbb{Z}[X_1, \cdots, X_m]$. Vice verse, each polynomial $f\in \mathbb{Z}[X_1, \cdots, X_m]$ can be represented as an AC. 
	
	We observe that, given an AC, one can construct an SL[$\concat, \replaceall$] formula as follows. Each node $n$ of the AC is associated with a string variable $x_n$. As a result, each input node of the AC labelled by $X_i$ (i.e., the indeterminate) corresponds to a  source variable. Furthermore,  
	\begin{itemize}
		\item For each internal node $n$ labelled by $+$, suppose that $n$ has two children nodes $n_l$ and $n_r$, we introduce a string constraint $x_n= x_{n_l}\concat x_{n_l}$.  
		
		\item For each internal node $n$ labelled by $*$, suppose that $n$ has two children nodes $n_l$ and $n_r$, we introduce a string constraint $x_n= \replaceall(x_{n_l}, a, x_{n_l})$.  
		
	\end{itemize}
  \end{proof}

\subsection{Undecidability of character and length constraints}



We have the following simple observation:

\begin{lemma}
	For any two strings $x,y\in a^*\$$, $|x|=|y|$ iff $\exists n. x[n]=y[n]=\$$. 
\end{lemma}
\tl{I am not satisfied with this as the quantifier is used}

\paragraph{IndexOf}
One reason of introducing character constraints is, apart from the use of the JavaScript string method chatAt (which is used rather frequently in JavaScript according to the benchmark \cite{}), they can also be used to define IndexOf, which is the most standard usage of IndexOf method in practice. We consider the \emph{first-occurrence} semantics, i.e., (the first position in $x$ where $w$ occurs).
and the \emph{anywhere} semantics. 

We have the following observation: 
\begin{lemma}
	For any two strings $x,y$ over $\{a\}$, $x=y$ iff $1=IndexOf(x,y)=IndexOf(y,x)$.  
\end{lemma}

It follows that 
\begin{proposition}
	$\strline[\replaceall]$ extended with IndexOf is undecidable, regardless of the first-occurrence and the anywhere semantics. 
\end{proposition}

\subsection{Extensions with disequalities and IndexOf}