%!TEX root = main.tex

%\subsection{Cost-enriched regular languages and recognisable relations}

A cost-enriched string is $(w, (n_1, \cdots, n_k))$ where $w$ is a string and $n_i \in \intnum$ for all $i \in [k]$. 
A cost-enriched language $L$ is a subset of $\Sigma^* \times \intnum^k$ for some $k$. Note that all the cost-enriched strings in $L$ are associated with the same number of costs (i.e., $k$).
A cost-enriched relation $\cR$ is a subset of $\Sigma^* \times \intnum^{k_1} \times \cdots \Sigma^* \times \intnum^{k_l}$.

\begin{definition}[Cost-enriched finite automata and regular languages]
	A cost-enriched finite automaton (CEFA) $\NFA$ is a tuple $(Q, \Sigma, R, \delta, I, F)$ where $Q, \Sigma, I, F$ are defined as in FA, $R=(r_1, \cdots, r_k)$ is a vector of (mutually distinct) registers, $\delta$ is the transition relation which is a finite set of tuples $(q, \sigma, q', \eta)$ where $q, q' \in Q$, $\sigma \in \Sigma$, and $\eta: R \rightarrow \intnum$ is the cost-update function. For convenience, we usually write $(q, \sigma, q', \eta) \in \Delta$ as $q \xrightarrow{\sigma, \eta} q'$.
	
	A cost-enriched string $(\sigma_1 \cdots \sigma_m, (n_1, \cdots,n_k)) \in \Sigma^* \times \intnum^k$ is accepted by $\NFA$ if there is a sequence of transitions $q_0 \xrightarrow{\sigma_1, \eta_1} q_1 \cdots q_{m-1} \xrightarrow{\sigma_m, \eta_m} q_m$ such that $n_i = \sum_{1\leq j\leq m}\eta_j(r_i)$ for each $i \in [k]$. The set of cost-enriched strings accepted by $\NFA$ is denoted as $\Lang(\NFA)$. A cost-enriched language $L \subseteq \Sigma^* \times \intnum^k$ is called a cost-enriched regular language (CERL) if there is a CEFA $\NFA$ such that $L = \Lang(\NFA)$.
\end{definition}


For a CEFA $\NFA$, we use $R(\NFA)$ to denote the registers occurring in $\NFA$. %Moreover, for a CEFA $\NFA$ and 
Given a vector of integer variables $\vec{i}$ such that $R(\NFA) \cap \vec{i} = \emptyset$, we use $\NFA[\vec{i}/R(\NFA)]$ to denote the CEFA obtained from $\NFA$ by replacing the registers in $R(\NFA)$ with those from $\vec{i}$. 

CEFA can be seen as a variant of Cost Register Automata \cite{RLJ+13}, by admitting nondeterminism and discarding partial final cost functions. 

%Let $\NFA = (Q, \Sigma, R, \delta, I, F)$ be a CEFA and $I',F' \in Q$. Then we use $\NFA_{I', F'}$ to denote the CEFA $(Q, \Sigma, R, \delta, I', F')$.

Given two CEFAs $\NFA_1 = ( Q_1, \Sigma, R_1, \delta_1, I_1, F_1)$ and $\NFA_2 = (Q_2, \Sigma, \delta_2, R_2, I_2, F_2)$ with $R_1 \cap R_2 = \emptyset$,  the product of $\NFA_1$ and $\NFA_2$, denoted by $\NFA_1 \times \NFA_2$, is defined as $(Q_1 \times Q_2, \Sigma, R_1 \cup R_2, \delta, I_1 \times I_2, F_1 \times F_2)$ where $\delta$ comprises the tuples $((q_1, q_2), \sigma, (q'_1, q'_2), \eta)$ such that $(q_1, \sigma, q'_1, \eta_1) \in \delta_1$, $(q_2, \sigma, q'_2, \eta_2) \in \delta_2$, and $\eta = \eta_1\cup \eta_2$.  %for some $\eta_1, \eta_2$.

%Note that according to the definition, over each word $w$, $\NFA^{(r)}(w) = \NFA(w)$. 

\begin{definition}[LA-SAT w.r.t. CEFA]\label{def-la-sat-cefa}
	Given $k$ CEFAs $\NFA_i=(Q_i, \Sigma, R_i, \delta_i, I_i, F_i)$ for $i\in [k]$, % , $\cdots$, $\NFA_k=(Q_k, \Sigma, R_k, \delta_k, I_k, F_k)$ be CEFAs
	%  with $R_i = (r_{i,1}, \cdots, r_{i, l_i})$ for each $i \in [k]$, 
	and  a quantifier-free linear arithmetic formula $\phi$ 
	%    
	whose free variables contain $\bigcup_{i\in [k]} R_i$. Then $\phi$ is said to be satisfiable w.r.t. $\NFA_1, \cdots, \NFA_k$ if  there are words $w_1, \cdots, w_k$ and an assignment function $\eta$ %: R_1 \cup \cdots R_k \cup X \rightarrow \intnum$  %integers $\vec{c_1} \in \intnum^{|R_1|}, \cdots, \vec{c_k} \in \intnum^{|R_k|}$, $\vec{d} \in \intnum^{|X|}$
	such that  $(w_i, \eta(R_i)) \in \Lang(\NFA_i)$ for $1\leq i\leq k$, and $\phi$ holds under $\eta$.
	%
	%  
	%  whose free variables are from  $R_1 \cup \cdots \cup R_k \cup X$ for some $X$ such that $X \cap (R_1 \cup \cdots \cup R_k) = \emptyset$. Then $\phi$ is said to be satisfiable w.r.t. $\NFA_1, \cdots, \NFA_k$ if  there are words $w_1, \cdots, w_k$ and an assignment function $\eta: R_1 \cup \cdots R_k \cup X \rightarrow \intnum$  %integers $\vec{c_1} \in \intnum^{|R_1|}, \cdots, \vec{c_k} \in \intnum^{|R_k|}$, $\vec{d} \in \intnum^{|X|}$
	% such that  $(w_1, \eta(R_1)) \in \Lang(\NFA_1)$, $ \cdots$, $(w_k, \eta(R_k)) \in \Lang(\NFA_k)$, and $\phi[\eta(R_1)/R_1, \cdots,\eta(R_k)/R_k, \eta(X)/X]$ holds.
\end{definition}
Note that in Definition~\ref{def-la-sat-cefa}, registers in $\NFA_i$'s may intersect. %it may happen that $R_i \cap R_j \neq \emptyset$ for some $i, j \in [k]$ with $i \neq j$.

\begin{theorem}\label{thm-incra-la-sat}
	The LA-SAT w.r.t. CEFA problem is decidable.
\end{theorem}

For the proof of Theorem~\ref{thm-incra-la-sat}, we state and prove the following lemma. 

\begin{lemma}\label{lem-incra-la}
	Let $\NFA=(Q, \Sigma, R, \delta, I, F)$ be a CEFA with $R= (r_1, \cdots,  r_m)$. Then there is an existential linear arithmetic formula $\varphi_\NFA(r_1, \cdots, r_m)$ such that $\cM(\varphi_\NFA)= \{(c_1, \cdots, c_m) \mid \exists w.  (w, c_1, \cdots, c_m) \in \Lang(\NFA)\}$.
\end{lemma}

\begin{proof}
	Let $\delta = \{\tau_1, \cdots, \tau_l\}$ such that $\tau_j = (p_j, \sigma_j, p'_j, \eta_j)$ and $\eta_j(r_i) =  c_{i,j}$ for each $j \in [l]$ and $i \in [m]$.
	According the results on FA, we know that for each pair of states $(q, q') \in I \times F$,  an existential linear arithmetic formula $\varphi_{q,q'}(j_1, \cdots, j_l)$ can be computed in linear time such that $\cM(\varphi_{q,q'})$ is the set of Parikh images of the transition sequences of $\NFA$ starting from $q$ and ending at $q'$. 
	
	Then 
	\[\varphi_\NFA(r_1, \cdots, r_m) ::= \bigvee \limits_{(q,q') \in I \times F} \exists j_1 \cdots \exists j_l.\ \left(\varphi_{q,q'}(j_1, \cdots, j_l) \wedge \bigwedge \limits_{i \in [m]} r_i = \sum \limits_{j \in [l]} c_{i,j} j_j \right).\]
	\qed
\end{proof}

\begin{proof}[Theorem~\ref{thm-incra-la-sat}]
	Let $\NFA_1=(Q_1, \Sigma, R_1, \delta_1, I_1, F_1)$, $\cdots$, $\NFA_k=(Q_k, \Sigma, R_k, \delta_k, I_k, F_k)$ be CEFAs and $\phi$ be a quantifier-free linear arithmetic formula whose free variables are from  $R_1 \cup \cdots \cup R_k \cup X$ for some $X$ such that $X \cap (R_1 \cdots R_k) = \emptyset$.
	Suppose that for each $i \in [k]$, $R_i = (r_{i, 1}, \cdots, r_{i, l_i})$. Then the satisfiability of $\phi$ w.r.t. $\NFA_1,\cdots, \NFA_k$ can be reduced to the satisfiability problem of the  existential linear arithmetic formula
	$
	\phi \wedge \bigwedge \limits_{i \in [k]} \varphi_{\NFA_i}(r_{i,1}, \cdots, r_{i, l_i}).
	$
\end{proof}

\begin{definition}[Cost-enriched recognisable relations]
	A cost-enriched relation $\cR \subseteq \Sigma^* \times \intnum^{k_1} \times \cdots  \times \Sigma^* \times \intnum^{k_l}$ is a cost-enriched recognisable relation (CERR)  if it is a finite union of products of cost-enriched regular languages, namely, 
	\[\cR = \bigcup \limits_{i=1}^n L_{i,1 } \times \cdots \times L_{i, l},\]
	where $L_{i,1} \subseteq \Sigma^* \times \intnum^{k_1}, \cdots, L_{i, l} \subseteq \Sigma^* \times \intnum^{k_l}$ are CERL. 
	A CEFA representation of $\cR$ is a collection of CERA tuples $(\NFA_{i,1}, \cdots, \NFA_{i,l})_{i \in [n]}$ such that $\Lang(\NFA_{i,j}) = L_{i,j}$ for each $i \in [n]$ and $j \in [l]$.
\end{definition}
